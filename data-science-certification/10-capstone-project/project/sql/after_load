ALTER TABLE bigram ADD COLUMN id INTEGER;
ALTER TABLE bigram ADD COLUMN word1 INTEGER;
ALTER TABLE bigram ADD COLUMN wordcode INTEGER;

ALTER TABLE trigram ADD COLUMN id INTEGER;
ALTER TABLE trigram ADD COLUMN word1 INTEGER;
ALTER TABLE trigram ADD COLUMN word2 INTEGER;
ALTER TABLE trigram ADD COLUMN wordcode INTEGER;

ALTER TABLE fourgram ADD COLUMN id INTEGER;
ALTER TABLE fourgram ADD COLUMN word1 INTEGER;
ALTER TABLE fourgram ADD COLUMN word2 INTEGER;
ALTER TABLE fourgram ADD COLUMN word3 INTEGER;
ALTER TABLE fourgram ADD COLUMN wordcode INTEGER;

-- add manually primary key on id autoincrement, unique on first and word
-- key on ungrams

CREATE VIEW bigram_threshold AS
       SELECT g.first,
              max( g.total ) / 2.0 threshold
         FROM ( 
           SELECT t.first,
                  u.POStag,
                  sum( t.total )  total
             FROM bigram t, 
                  unigram u
            WHERE t.word = u.word
            GROUP BY t.first,
                     u.POStag
            ORDER BY t.first,
                      u.POStag 
       ) 
       g
        GROUP BY g.first
        ORDER BY g.first;

CREATE VIEW bigram_under_threshold AS
       SELECT t.first,
              t.POStag,
              t.conteggio
         FROM ( 
           SELECT t.first,
                  u.POStag,
                  sum( t.total )  conteggio
             FROM bigram t, 
                  unigram u
            WHERE t.word = u.word
            GROUP BY t.first,
                     u.POStag 
       ) 
       t
              INNER JOIN bigram_threshold s
                      ON t.first = s.first
        WHERE t.conteggio < s.threshold;
        
                
CREATE VIEW trigram_threshold AS
       SELECT g.first,
              max( g.total ) / 2.0 threshold
         FROM ( 
           SELECT t.first,
                  u.POStag,
                  sum( t.total )  total
             FROM trigram t, 
                  unigram u
            WHERE t.word = u.word
            GROUP BY t.first,
                     u.POStag
            ORDER BY t.first,
                      u.POStag 
       ) 
       g
        GROUP BY g.first
        ORDER BY g.first;
        
CREATE VIEW trigram_under_threshold AS
       SELECT t.first,
              t.POStag,
              t.conteggio
         FROM ( 
           SELECT t.first,
                  u.POStag,
                  sum( t.total )  conteggio
             FROM trigram t, 
                  unigram u
            WHERE t.word = u.word
            GROUP BY t.first,
                     u.POStag 
       ) 
       t
              INNER JOIN trigram_threshold s
                      ON t.first = s.first
        WHERE t.conteggio < s.threshold;


CREATE VIEW fourgram_threshold AS
       SELECT g.first,
              max( g.total ) / 2.0 threshold
         FROM ( 
           SELECT t.first,
                  u.POStag,
                  sum( t.total )  total
             FROM fourgram t, 
                  unigram u
            WHERE t.word = u.word
            GROUP BY t.first,
                     u.POStag
            ORDER BY t.first,
                      u.POStag 
       ) 
       g
        GROUP BY g.first
        ORDER BY g.first;

CREATE VIEW fourgram_under_threshold AS
       SELECT t.first,
              t.POStag,
              t.conteggio
         FROM ( 
           SELECT t.first,
                  u.POStag,
                  sum( t.total )  conteggio
             FROM fourgram t, 
                  unigram u
            WHERE t.word = u.word
            GROUP BY t.first,
                     u.POStag 
       ) 
       t
              INNER JOIN fourgram_threshold s
                      ON t.first = s.first
        WHERE t.conteggio < s.threshold;



